services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    environment:
      - SERVER_PORT=8080
      - SERVER_ALLOWED_ORIGINS=http://localhost:3000
      - VELERO_NAMESPACE=velero
      - KUBECONFIG=/root/.kube/config
      # Auth: none (default), basic, oidc
      - AUTH_MODE=none
      # - JWT_SECRET=change-me-in-production
      # - JWT_EXPIRATION=24h
      # Basic auth: user:bcrypt_hash:role,...
      # - AUTH_USERS=admin:$$2a$$10$$...:admin
      # OIDC settings:
      # - OIDC_ISSUER=https://accounts.google.com
      # - OIDC_CLIENT_ID=xxx
      # - OIDC_CLIENT_SECRET=xxx
      # - OIDC_REDIRECT_URL=http://localhost:8080/api/auth/oidc/callback
      # - OIDC_ADMIN_GROUPS=velero-admins
      # - OIDC_OPERATOR_GROUPS=velero-operators
      # - OIDC_DEFAULT_ROLE=viewer
    volumes:
      - ~/.kube/config:/root/.kube/config:ro

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - BACKEND_URL=http://backend:8080
    depends_on:
      - backend
